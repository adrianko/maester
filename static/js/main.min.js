// Generated by CoffeeScript 1.7.1
(function() {
  (function($) {
    var component_stash, createTask, getCookie, modal;
    component_stash = {};
    modal = "";
    $.ajaxSetup({
      beforeSend: function(xhr, settings) {
        if (!(/^https?:.*/.test(settings.url))) {
          return xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
        }
      }
    });
    $("a.new-task").on("click", function() {
      $('#new-task-modal-title').val("");
      $('#new-task-modal-desc').val("");
      $('#new-task-modal-duration').val("0");
      $('#new-task-modal-duration-unit').val("0");
      $('#new-task-modal-users').val("0");
      modal = $(this).attr('data-category');
      return void 0;
    });
    $("#new-task-modal-submit").on("click", function() {
      var component, s;
      component = 0;
      if (!("task" in component_stash)) {
        component = 1;
      }
      $.ajax({
        type: "POST",
        url: "/api/set/task/new",
        data: {
          component: component,
          data: {
            title: $('#new-task-modal-title').val(),
            category: modal,
            order: $(".panel[data-category='" + modal + "'] .panel-body .well").length + 1,
            desc: $('#new-task-modal-desc').val(),
            duration: $('#new-task-modal-duration').val(),
            duration_unit: $('#new-task-modal-duration-unit').val(),
            users: JSON.stringify((function() {
              var _i, _len, _ref, _results;
              _ref = $('#new-task-modal-users :selected');
              _results = [];
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                s = _ref[_i];
                _results.push($(s).val());
              }
              return _results;
            })())
          }
        },
        success: function(data) {
          console.log(data);
          if (component === 1) {
            component_stash.task = data.data.components;
          }
          return createTask();
        }
      });
      return void 0;
    });
    createTask = function() {
      $("div.panel[data-category='" + modal + "'] .panel-body").append(component_stash.task.replace('{{ title }}', $('#new-task-modal-title').val()));
      $("#new-task-modal").modal("hide");
      return void 0;
    };
    getCookie = function(name) {
      var cookie, _i, _len, _ref;
      _ref = document.cookie.split(";");
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        cookie = _ref[_i];
        if (cookie && name === (cookie.split("="))[0]) {
          return decodeURIComponent(cookie.slice(1 + name.length));
        }
      }
      return null;
    };
    return void 0;
  })(jQuery);

}).call(this);
