// Generated by CoffeeScript 1.7.1
(function() {
  (function($) {
    var board_action, board_delete, board_edit, component_stash, modalLabels;
    component_stash = {};
    board_delete = "";
    board_edit = "";
    board_action = "";
    modalLabels = function() {
      if (board_action === "edit") {
        $("#board-modal .modal-dialog .modal-content .modal-header .modal-title").text("Edit board");
        $("#board-modal-submit").text("Update");
      } else {
        $("#board-modal .modal-dialog .modal-content .modal-header .modal-title").text("Add board");
        $("#board-modal-submit").text("Add");
      }
      return void 0;
    };
    $(document.body).on("click", ".new-board", function() {
      board_action = "new";
      modalLabels();
      $("#board-modal-title").val("");
      $("#board-modal-desc").val("");
      $("#board-modal-bg").val("#ffffff");
      $("#board-modal-bg").attr("value", "#ffffff");
      $(".input-group").colorpicker("setValue", "#ffffff");
      $("#board-modal").modal("show");
      return void 0;
    });
    $(document.body).on("click", "#board-modal-submit", function() {
      var background, component, description, title;
      title = $("#board-modal-title").val();
      description = $("#board-modal-desc").val();
      background = $("#board-modal-bg").val();
      $("#board-modal").modal("hide");
      if (board_action === "new") {
        component = 0;
        if (!("boarditem" in component_stash)) {
          component = 1;
        }
        $.ajax({
          type: "POST",
          url: "/api/set/board/new",
          data: {
            component: component,
            title: title,
            description: description,
            background: background
          },
          success: function(data) {
            var board;
            if (data.code !== 200) {
              console.log("ERROR: " + data.code);
            }
            if (component === 1) {
              component_stash.boarditem = data.data.components;
            }
            board = component_stash.boarditem;
            board = board.split("{{ b.id }}");
            board = board.join(data.data.id);
            board = board.replace("{{ b.title }}", title);
            board = board.replace("{{ b.description }}", description);
            board = board.split("{{ b.background }}");
            board = board.join(data.data.background);
            $(".boards").eq(0).append(board);
            return $("#board-modal").modal("hide");
          },
          error: function(jqXHR, textStatus, err) {
            return console.log(err);
          }
        });
      } else {
        $.ajax({
          type: "POST",
          url: "/api/set/board/update",
          data: {
            id: board_edit,
            title: title,
            description: description,
            background: background
          },
          success: function(data) {
            if (data.code !== 200) {
              console.log("ERROR: " + data.code);
            }
            $(".boards .board-item[data-board='" + board_edit + "'] .board-title").text(title);
            $(".boards .board-item[data-board='" + board_edit + "'] .board-description").text(description);
            $(".boards .board-item[data-board='" + board_edit + "']").attr("data-background", background);
            $(".boards .board-item[data-board='" + board_edit + "']").css("background", background);
            $("#board-modal").modal("hide");
            return board_edit = "";
          },
          error: function(jqXHR, textStatus, err) {
            return console.log(err);
          }
        });
      }
      board_action = "";
      return void 0;
    });
    $(document.body).on("click", ".board-link", function() {
      window.location.href = $(this).attr("data-href");
      return void 0;
    });
    $(document.body).on("click", ".board-dd", function(e) {
      e.preventDefault();
      e.stopPropagation();
      $(this).dropdown("toggle");
      return void 0;
    });
    $(document.body).on("click", ".board-edit", function(e) {
      var bg_col;
      e.preventDefault();
      e.stopPropagation();
      board_edit = $(this).attr("data-id");
      board_action = "edit";
      bg_col = "#" + $(this).closest(".board-item").attr("data-background");
      modalLabels();
      $("#board-modal-title").val($(this).closest(".board-item").find(".board-title").text());
      $("#board-modal-desc").val($(this).closest(".board-item").find(".board-description").text());
      $("#board-modal-bg").attr("value", bg_col);
      $(".input-group").colorpicker("setValue", bg_col);
      $("#board-modal").modal("show");
      return void 0;
    });
    $(document.body).on("click", ".board-delete", function(e) {
      e.preventDefault();
      e.stopPropagation();
      board_delete = $(this).attr("data-id");
      $("#delete-board-modal").modal("show");
      return void 0;
    });
    $(document.body).on("click", "#delete-board-no", function() {
      $("#delete-board-modal").modal("hide");
      return void 0;
    });
    $(document.body).on("click", "#delete-board-yes", function() {
      $.ajax({
        type: "POST",
        url: "/api/set/board/delete",
        data: {
          id: board_delete
        },
        success: function(data) {
          if (data.code !== 200) {
            console.log("ERROR: " + data.code);
          }
          $(".boards .board-item[data-board='" + board_delete + "']").remove();
          $("#delete-board-modal").modal("hide");
          return board_delete = "";
        },
        error: function(jqXHR, textStatus, err) {
          return console.log(err);
        }
      });
      return void 0;
    });
    return $(".input-group").colorpicker();
  })(jQuery);

}).call(this);
