// Generated by CoffeeScript 1.7.1
(function() {
  (function($) {
    var board_id, component_stash, home_board;
    component_stash = {};
    home_board = "";
    board_id = "";
    $(document.body).on("click", "a.new-board", function() {
      $("#new-board-modal-title").val("");
      return void 0;
    });
    $(document.body).on("click", "#new-task-modal-submit", function() {
      var component, s;
      component = 0;
      if (!("task" in component_stash)) {
        component = 1;
      }
      $.ajax({
        type: "POST",
        url: "/api/set/task/new",
        data: {
          component: component,
          data: {
            title: $("#new-task-modal-title").val(),
            category: new_task_category,
            order: $(".panel[data-category='" + new_task_category + "'] .panel-body .well").length + 1,
            desc: $("#new-task-modal-desc").val(),
            duration: $("#new-task-modal-duration").val(),
            duration_unit: $("#new-task-modal-duration-unit").val(),
            users: JSON.stringify((function() {
              var _i, _len, _ref, _results;
              _ref = $("#new-task-modal-users :selected");
              _results = [];
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                s = _ref[_i];
                _results.push($(s).val());
              }
              return _results;
            })())
          }
        },
        success: function(data) {
          var task;
          if (component === 1) {
            component_stash.task = data.data.components;
          }
          task = component_stash.task;
          task = task.replace("{{ title }}", $("#new-task-modal-title").val());
          task = task.replace("{{ id }}", data.data.id);
          $("div.panel[data-category='" + new_task_category + "'] .panel-body .task-list").append(task);
          return $("#new-task-modal").modal("hide");
        },
        error: function(jqXHR, textStatus, err) {
          return console.log(err);
        }
      });
      return void 0;
    });
    $(document.body).on("click", "#new-board-modal-submit", function() {
      var component, title;
      component = 0;
      if (!("boarditem" in component_stash)) {
        component = 1;
      }
      title = $("#new-board-modal-title").val();
      $("#new-board-modal").modal("hide");
      $.ajax({
        type: "POST",
        url: "/api/set/board/new",
        data: {
          component: component,
          title: title
        },
        success: function(data) {
          var board;
          console.log(data);
          if (data.code !== 200) {
            console.log("ERROR: " + data.code);
          }
          if (component === 1) {
            component_stash.boarditem = data.data.components;
          }
          board = component_stash.boarditem;
          board = board.split("{{ id }}");
          board = board.join(data.data.id);
          board = board.replace("{{ title }}", title);
          $(".boards").eq(0).append(board);
          return $("#new-board-modal").modal("hide");
        },
        error: function(jqXHR, textStatus, err) {
          return console.log(err);
        }
      });
      return void 0;
    });
    $(document.body).on("click", ".board-link", function() {
      window.location.href = $(this).attr("data-href");
      return void 0;
    });
    $(document.body).on("click", ".board-edit", function() {
      board_id = $(this).parent().parent().closest("li").attr("data-board");
      $("#edit-board-modal-title").val($(this).closest(".btn-group").find(".board-link").eq(0).text());
      $("#edit-board-modal").modal("show");
      return void 0;
    });
    $(document.body).on("click", "#edit-board-modal-submit", function() {
      var title;
      title = $("#edit-board-modal-title").val();
      $.ajax({
        type: "POST",
        url: "/api/set/board/update",
        data: {
          id: board_id,
          title: title
        },
        success: function(data) {
          console.log(data);
          if (data.code !== 200) {
            console.log("ERROR: " + data.code);
          }
          $("ul.boards li[data-board='" + board_id + "'] .btn-group .board-link").text(title);
          $("#edit-board-modal").modal("hide");
          return board_id = "";
        },
        error: function(jqXHR, textStatus, err) {
          return console.log(err);
        }
      });
      return void 0;
    });
    $(document.body).on("click", ".board-delete", function() {
      home_board = $(this).attr("data-task");
      $("#delete-board-modal").modal("show");
      return void 0;
    });
    $(document.body).on("click", "#delete-board-no", function() {
      $("#delete-board-modal").modal("hide");
      return void 0;
    });
    return $(document.body).on("click", "#delete-board-yes", function() {
      $.ajax({
        type: "POST",
        url: "/api/set/board/delete",
        data: {
          id: home_board
        },
        success: function(data) {
          if (data.code !== 200) {
            console.log("ERROR: " + data.code);
          }
          $("ul.boards li[data-board='" + home_board + "']").remove();
          $("#delete-board-modal").modal("hide");
          return home_board = "";
        },
        error: function(jqXHR, textStatus, err) {
          return console.log(err);
        }
      });
      return void 0;
    });
  })(jQuery);

}).call(this);
